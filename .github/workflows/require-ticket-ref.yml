name: require-ticket-ref

on:
  pull_request:
    types: [opened, edited, synchronize, reopened, ready_for_review]

jobs:
  require:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: read
      contents: read
    steps:
      - name: Validate PR references an issue (#123)
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            if (!pr) {
              core.setFailed('No pull_request found in context');
              return;
            }

            const re = /#[0-9]+/;
            const prText = `${pr.title}\n${pr.body || ''}`;
            if (!re.test(prText)) {
              core.setFailed('PR title/body must contain a GitHub issue reference like #123 (prefer: "Closes #123")');
            }